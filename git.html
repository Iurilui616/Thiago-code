<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Sabor - Sistema Inteligente de Confeitaria</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #dc143c;
            --primary-dark: #8b0000;
            --primary-light: #ff1744;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --gray: #6c757d;
            --dark: #212529;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #fff 0%, #ffe5e5 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .intro-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            text-align: center;
            padding: 3rem;
            position: relative;
            overflow: hidden;
        }

        .intro-section::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveBackground 20s linear infinite;
        }

        @keyframes moveBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .logo {
            font-size: 6rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            text-shadow: 4px 4px 12px rgba(0,0,0,0.4);
            animation: logoFloat 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
            letter-spacing: -3px;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-20px) scale(1.02); }
        }

        .tagline {
            font-size: 2rem;
            margin-bottom: 4rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .user-type-cards {
            display: flex;
            gap: 3rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: cardsAppear 1s ease-out 0.5s both;
            position: relative;
            z-index: 1;
        }

        @keyframes cardsAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .user-card {
            background: white;
            color: var(--primary);
            padding: 3.5rem 3rem;
            border-radius: 30px;
            width: 350px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220,20,60,0.15), transparent);
            transition: left 0.6s;
        }

        .user-card:hover::before {
            left: 100%;
        }

        .user-card:hover {
            transform: translateY(-20px) scale(1.08);
            box-shadow: 0 25px 70px rgba(220,20,60,0.5);
        }

        .user-card-icon {
            font-size: 5rem;
            margin-bottom: 2rem;
            display: block;
            animation: iconBounce 2s ease-in-out infinite;
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .user-card h3 {
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            font-weight: 800;
        }

        .user-card p {
            color: #666;
            line-height: 1.9;
            font-size: 1.1rem;
        }

        .login-section {
            display: none;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: linear-gradient(135deg, #fff 0%, #ffe5e5 100%);
        }

        .login-container {
            background: white;
            padding: 4.5rem 3.5rem;
            border-radius: 35px;
            box-shadow: 0 25px 70px rgba(220, 20, 60, 0.3);
            width: 100%;
            max-width: 520px;
            border: 5px solid var(--primary);
            animation: slideIn 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(220,20,60,0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes slideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-container h2 {
            color: var(--primary);
            margin-bottom: 3rem;
            text-align: center;
            font-size: 2.8rem;
            font-weight: 900;
            position: relative;
            z-index: 1;
        }

        .form-group {
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .form-group label {
            display: block;
            color: #333;
            margin-bottom: 1rem;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .form-group input {
            width: 100%;
            padding: 1.4rem;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.15rem;
            transition: all 0.3s;
            background: #f8f9fa;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 5px rgba(220,20,60,0.1);
            transform: translateY(-2px);
        }

        .password-strength {
            margin-top: 0.8rem;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            border-radius: 10px;
        }

        .password-requirements {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
            display: none;
        }

        .requirement {
            padding: 0.3rem 0;
            transition: color 0.3s;
        }

        .requirement.met {
            color: var(--success);
        }

        .btn {
            width: 100%;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s;
            box-shadow: 0 8px 25px rgba(220,20,60,0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(220,20,60,0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .back-btn {
            background: linear-gradient(135deg, #666 0%, #444 100%);
            margin-top: 1.5rem;
        }

        .register-link {
            text-align: center;
            margin-top: 2rem;
            color: #666;
            font-size: 1.05rem;
            position: relative;
            z-index: 1;
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s;
        }

        .register-link a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .dashboard-section {
            display: none;
            min-height: 100vh;
            padding: 3rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffe5e5 100%);
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2.5rem 3rem;
            border-radius: 25px;
            margin-bottom: 3.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 15px 50px rgba(220, 20, 60, 0.4);
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        .dashboard-header-content {
            position: relative;
            z-index: 1;
        }

        .dashboard-header h2 {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .dashboard-header .user-info {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .logout-btn, .profile-btn {
            padding: 1.2rem 2.5rem;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.15rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .logout-btn:hover, .profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 3rem;
        }

        .dashboard-card {
            background: white;
            padding: 3rem;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.12);
            border-left: 8px solid var(--primary);
            transition: all 0.4s;
            animation: cardFadeIn 0.7s ease-out;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, rgba(220,20,60,0.02) 100%);
            pointer-events: none;
        }

        @keyframes cardFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(220,20,60,0.25);
        }

        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .dashboard-card p {
            color: #555;
            line-height: 2;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }

        .status-badge {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 800;
            margin: 0.5rem 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .status-badge:hover {
            transform: scale(1.08);
        }

        .status-open {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            box-shadow: 0 4px 15px rgba(21,87,36,0.3);
        }

        .status-closed {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            box-shadow: 0 4px 15px rgba(114,28,36,0.3);
        }

        .cart-item, .order-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            z-index: 1;
        }

        .cart-item:hover, .order-item:hover {
            border-color: var(--primary);
            transform: translateX(8px);
            box-shadow: 0 5px 20px rgba(220,20,60,0.2);
        }

        .cart-item-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .cart-item-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
        }

        .cart-item-btn.remove {
            background: var(--danger);
            color: white;
        }

        .cart-item-btn.add {
            background: var(--success);
            color: white;
        }

        .product-list {
            list-style: none;
        }

        .product-list li {
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            margin-bottom: 1.5rem;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: 3px solid transparent;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .product-list li:hover {
            border-color: var(--primary);
            transform: translateX(8px);
            box-shadow: 0 5px 20px rgba(220,20,60,0.2);
        }

        .add-to-cart-btn {
            padding: 0.8rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-to-cart-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .metric {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--primary);
            margin: 2rem 0;
            text-shadow: 2px 2px 4px rgba(220,20,60,0.1);
            position: relative;
            z-index: 1;
        }

        .map-container {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            height: 350px;
            border-radius: 20px;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            border: 4px solid #4caf50;
            box-shadow: 0 5px 20px rgba(76,175,80,0.3);
        }

        .map-marker {
            position: absolute;
            width: 45px;
            height: 45px;
            background: var(--primary);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            box-shadow: 0 5px 20px rgba(220,20,60,0.6);
            cursor: pointer;
            transition: all 0.3s;
            animation: markerBounce 2s ease-in-out infinite;
        }

        @keyframes markerBounce {
            0%, 100% { transform: rotate(-45deg) translateY(0); }
            50% { transform: rotate(-45deg) translateY(-15px); }
        }

        .map-marker:hover {
            transform: rotate(-45deg) scale(1.3);
        }

        .map-marker::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }

        .order-info {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border-left: 6px solid var(--warning);
            box-shadow: 0 5px 20px rgba(255,193,7,0.3);
            position: relative;
            z-index: 1;
        }

        .order-info strong {
            color: #856404;
            font-size: 1.2rem;
        }

        .confirm-btn {
            width: 100%;
            padding: 1.8rem;
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 2rem;
            font-size: 1.3rem;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(40,167,69,0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .confirm-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(40,167,69,0.5);
        }

        .location-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 2rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            border-left: 6px solid #2196f3;
            box-shadow: 0 5px 20px rgba(33,150,243,0.3);
            position: relative;
            z-index: 1;
        }

        .location-info strong {
            color: #0d47a1;
            font-size: 1.2rem;
        }

        .chart-bar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            height: 35px;
            border-radius: 10px;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(220,20,60,0.4);
        }

        .chart-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 2rem 2.5rem;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            border-left: 6px solid var(--primary);
            z-index: 10000;
            animation: slideInRight 0.6s ease-out;
            max-width: 400px;
            min-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.hide {
            animation: slideOutRight 0.6s ease-out forwards;
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(500px); opacity: 0; }
        }

        .notification-title {
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .notification-message {
            color: #666;
            font-size: 1.05rem;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 3rem;
            border-radius: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.4s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 2rem;
            font-weight: 800;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .close-modal:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .profile-section {
            margin: 2rem 0;
        }

        .profile-section h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .profile-field {
            margin-bottom: 1.5rem;
        }

        .profile-field label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .profile-field input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(220,20,60,0.3);
        }

        .stat-box .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .stat-box .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--danger);
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--success);
            display: none;
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 4rem;
            }

            .tagline {
                font-size: 1.5rem;
            }

            .user-type-cards {
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }

            .user-card {
                width: 100%;
                max-width: 380px;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header h2 {
                font-size: 2.2rem;
            }

            .header-actions {
                flex-direction: column;
                width: 100%;
            }

            .logout-btn, .profile-btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <section id="intro" class="intro-section">
        <div class="logo">🍰 IA Sabor</div>
        <p class="tagline">Sistema Inteligente de Gestão de Confeitaria</p>
        <div class="user-type-cards">
            <div class="user-card" onclick="showLogin('cliente')">
                <span class="user-card-icon">👤</span>
                <h3>Cliente</h3>
                <p>Faça pedidos, acompanhe entregas em tempo real e descubra novos sabores próximos a você com inteligência artificial</p>
            </div>
            <div class="user-card" onclick="showLogin('confeiteiro')">
                <span class="user-card-icon">👨‍🍳</span>
                <h3>Confeiteiro</h3>
                <p>Gerencie seu negócio com inteligência artificial, acompanhe vendas e otimize sua produção em tempo real</p>
            </div>
            <div class="user-card" onclick="showLogin('motoboy')">
                <span class="user-card-icon">🏍️</span>
                <h3>Motoboy</h3>
                <p>Receba pedidos otimizados por localização GPS e maximize seus ganhos com rotas inteligentes</p>
            </div>
        </div>
    </section>

    <section id="login-cliente" class="login-section">
        <div class="login-container">
            <h2>Login - Cliente</h2>
            <div class="error-message" id="error-cliente"></div>
            <div class="success-message" id="success-cliente"></div>
            <form onsubmit="login(event, 'cliente')">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="email-cliente" required placeholder="seu@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="password-cliente" required placeholder="••••••••" autocomplete="current-password">
                </div>
                <button type="submit" class="btn">Entrar</button>
                <button type="button" class="btn back-btn" onclick="backToIntro()">Voltar</button>
                <div class="register-link">
                    Não tem conta? <a href="#" onclick="showRegister('cliente'); return false;">Cadastre-se</a>
                </div>
            </form>
        </div>
    </section>

    <section id="login-confeiteiro" class="login-section">
        <div class="login-container">
            <h2>Login - Confeiteiro</h2>
            <div class="error-message" id="error-confeiteiro"></div>
            <div class="success-message" id="success-confeiteiro"></div>
            <form onsubmit="login(event, 'confeiteiro')">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="email-confeiteiro" required placeholder="seu@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="password-confeiteiro" required placeholder="••••••••" autocomplete="current-password">
                </div>
                <button type="submit" class="btn">Entrar</button>
                <button type="button" class="btn back-btn" onclick="backToIntro()">Voltar</button>
                <div class="register-link">
                    Não tem conta? <a href="#" onclick="showRegister('confeiteiro'); return false;">Cadastre-se</a>
                </div>
            </form>
        </div>
    </section>

    <section id="login-motoboy" class="login-section">
        <div class="login-container">
            <h2>Login - Motoboy</h2>
            <div class="error-message" id="error-motoboy"></div>
            <div class="success-message" id="success-motoboy"></div>
            <form onsubmit="login(event, 'motoboy')">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="email-motoboy" required placeholder="seu@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="password-motoboy" required placeholder="••••••••" autocomplete="current-password">
                </div>
                <button type="submit" class="btn">Entrar</button>
                <button type="button" class="btn back-btn" onclick="backToIntro()">Voltar</button>
                <div class="register-link">
                    Não tem conta? <a href="#" onclick="showRegister('motoboy'); return false;">Cadastre-se</a>
                </div>
            </form>
        </div>
    </section>

    <section id="dashboard-cliente" class="dashboard-section">
        <div class="dashboard-header">
            <div class="dashboard-header-content">
                <h2>🍰 Dashboard - Cliente</h2>
                <div class="user-info">Bem-vindo, <span id="user-name-cliente"></span></div>
            </div>
            <div class="header-actions">
                <button class="profile-btn" onclick="showProfile('cliente')">Perfil</button>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>📍 Confeitarias Próximas</h3>
                <div class="location-info">
                    <strong>Sua Localização:</strong><br>
                    <span id="user-location">Detectando localização GPS...</span>
                </div>
                <div id="stores-list"></div>
                <div class="map-container" id="map-cliente">
                    <div class="map-marker" style="top: 30%; left: 25%;" onclick="showStoreInfo('Doce Encanto')"></div>
                    <div class="map-marker" style="top: 60%; left: 55%;" onclick="showStoreInfo('Sabor Divino')"></div>
                    <div class="map-marker" style="top: 45%; left: 75%;" onclick="showStoreInfo('Delícias da Vovó')"></div>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>🍰 Cardápio</h3>
                <ul class="product-list" id="product-list">
                    <li>
                        <span>Bolo de Chocolate Premium</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 45,00</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Bolo de Chocolate Premium', 45.00)">Adicionar</button>
                        </div>
                    </li>
                    <li>
                        <span>Torta de Morango</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 38,00</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Torta de Morango', 38.00)">Adicionar</button>
                        </div>
                    </li>
                    <li>
                        <span>Brigadeiro Gourmet (un)</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 3,50</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Brigadeiro Gourmet', 3.50)">Adicionar</button>
                        </div>
                    </li>
                    <li>
                        <span>Cupcake Red Velvet</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 8,00</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Cupcake Red Velvet', 8.00)">Adicionar</button>
                        </div>
                    </li>
                    <li>
                        <span>Brownie de Chocolate</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 12,00</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Brownie de Chocolate', 12.00)">Adicionar</button>
                        </div>
                    </li>
                    <li>
                        <span>Cheesecake de Frutas Vermelhas</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <strong>R$ 42,00</strong>
                            <button class="add-to-cart-btn" onclick="addToCart('Cheesecake de Frutas Vermelhas', 42.00)">Adicionar</button>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="dashboard-card">
                <h3>⏱️ Tempo de Entrega</h3>
                <div class="metric" id="delivery-time">Calculando...</div>
                <p>Estimativa baseada na sua localização GPS atual</p>
                <p>Distância da confeitaria mais próxima: <strong id="nearest-distance">Calculando...</strong></p>
                <div class="loading-spinner" style="display: none;" id="time-spinner"></div>
            </div>
            <div class="dashboard-card">
                <h3>💡 Sugestões Personalizadas</h3>
                <p style="font-weight: 700; color: var(--primary);">Baseado nos seus pedidos anteriores:</p>
                <div style="margin-top: 1.5rem;" id="suggestions-list">
                    <p>🍰 Bolo de Chocolate Premium - Você pediu 3x</p>
                    <div class="chart-bar" style="width: 90%;"></div>
                    <p>🧁 Cupcake Red Velvet - Você pediu 2x</p>
                    <div class="chart-bar" style="width: 60%;"></div>
                    <p>🍓 Torta de Morango - Você pediu 1x</p>
                    <div class="chart-bar" style="width: 30%;"></div>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>🛒 Carrinho de Compras</h3>
                <div id="cart-items"></div>
                <div class="metric" id="cart-total">Total: R$ 0,00</div>
                <button class="btn" onclick="checkout()">Finalizar Pedido</button>
                <button class="btn back-btn" onclick="clearCart()">Limpar Carrinho</button>
            </div>
            <div class="dashboard-card">
                <h3>⭐ Confeitarias Favoritas</h3>
                <div id="favorites-list">
                    <p><strong>Doce Encanto</strong> - 4.9 ⭐ (234 avaliações)</p>
                    <p>Seguindo há 3 meses</p>
                    <p style="margin-top: 1.5rem;"><strong>Sabor Divino</strong> - 4.8 ⭐ (189 avaliações)</p>
                    <p>Seguindo há 1 mês</p>
                </div>
                <button class="btn" style="margin-top: 1.5rem;">Explorar Mais Confeitarias</button>
            </div>
            <div class="dashboard-card">
                <h3>📦 Histórico de Pedidos</h3>
                <div id="order-history"></div>
            </div>
        </div>
    </section>

    <section id="dashboard-confeiteiro" class="dashboard-section">
        <div class="dashboard-header">
            <div class="dashboard-header-content">
                <h2>👨‍🍳 Dashboard - Confeiteiro</h2>
                <div class="user-info">Bem-vindo, <span id="user-name-confeiteiro"></span></div>
            </div>
            <div class="header-actions">
                <button class="profile-btn" onclick="showProfile('confeiteiro')">Perfil</button>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value" id="stat-orders">18</div>
                <div class="stat-label">Pedidos Hoje</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="stat-revenue">R$ 945</div>
                <div class="stat-label">Receita Hoje</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="stat-rating">4.9</div>
                <div class="stat-label">Avaliação</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="stat-followers">1.247</div>
                <div class="stat-label">Seguidores</div>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>📊 Produto Mais Vendido</h3>
                <div class="metric">🍰 Bolo de Chocolate</div>
                <p><strong>156 unidades</strong> vendidas este mês</p>
                <p>Representa <strong>32%</strong> das vendas totais</p>
                <div class="chart-bar" style="width: 100%; margin-top: 2rem;"></div>
                <p style="margin-top: 1.5rem;">2º lugar: Torta de Morango (89 unidades)</p>
                <div class="chart-bar" style="width: 57%;"></div>
            </div>
            <div class="dashboard-card">
                <h3>💰 Renda Mensal</h3>
                <div class="metric">R$ 12.450,00</div>
                <p>Renda bruta: <strong>R$ 15.200,00</strong></p>
                <p>Custos operacionais: <strong>R$ 2.750,00</strong></p>
                <p style="color: var(--success); font-weight: bold; font-size: 1.3rem; margin-top: 1.5rem;">↑ +18% vs mês anterior</p>
                <div class="chart-bar" style="width: 82%; background: linear-gradient(135deg, var(--success) 0%, #20c997 100%); margin-top: 1.5rem;"></div>
            </div>
            <div class="dashboard-card">
                <h3>🗺️ Regiões com Maior Demanda</h3>
                <div class="location-info">
                    <strong>Sua Confeitaria:</strong><br>
                    <span id="store-location">Detectando localização GPS...</span>
                </div>
                <p><strong>1º Centro</strong> - 45 pedidos (2.3 km)</p>
                <div class="chart-bar" style="width: 100%;"></div>
                <p><strong>2º Jardim América</strong> - 32 pedidos (3.8 km)</p>
                <div class="chart-bar" style="width: 71%;"></div>
                <p><strong>3º Vila Nova</strong> - 28 pedidos (4.2 km)</p>
                <div class="chart-bar" style="width: 62%;"></div>
                <p><strong>4º Bela Vista</strong> - 19 pedidos (5.1 km)</p>
                <div class="chart-bar" style="width: 42%;"></div>
            </div>
            <div class="dashboard-card">
                <h3>📦 Pedidos Recentes</h3>
                <div id="recent-orders"></div>
            </div>
            <div class="dashboard-card">
                <h3>👥 Seguidores e Engajamento</h3>
                <div class="metric">1.247</div>
                <p><strong>+23 novos seguidores</strong> esta semana</p>
                <p>Taxa de engajamento: <strong>8.5%</strong></p>
                <div class="chart-bar" style="width: 85%; background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%); margin-top: 1.5rem;"></div>
                <p style="margin-top: 1.5rem;">Avaliação média: <strong>4.9 ⭐</strong> (234 avaliações)</p>
                <button class="btn" style="margin-top: 1.5rem;" onclick="sendNotificationToFollowers()">Enviar Notificação</button>
            </div>
            <div class="dashboard-card">
                <h3>📈 Análise de Desempenho</h3>
                <p>Pedidos hoje: <strong id="perf-orders">18</strong></p>
                <p>Ticket médio: <strong id="perf-ticket">R$ 52,30</strong></p>
                <p>Tempo médio de preparo: <strong id="perf-time">22 minutos</strong></p>
                <p>Taxa de satisfação: <strong id="perf-satisfaction">96%</strong></p>
                <div class="chart-bar" style="width: 96%; background: linear-gradient(135deg, var(--success) 0%, #20c997 100%); margin-top: 1.5rem;"></div>
            </div>
        </div>
    </section>

    <section id="dashboard-motoboy" class="dashboard-section">
        <div class="dashboard-header">
            <div class="dashboard-header-content">
                <h2>🏍️ Dashboard - Motoboy</h2>
                <div class="user-info">Bem-vindo, <span id="user-name-motoboy"></span></div>
            </div>
            <div class="header-actions">
                <button class="profile-btn" onclick="showProfile('motoboy')">Perfil</button>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value" id="moto-deliveries">12</div>
                <div class="stat-label">Entregas Hoje</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="moto-earnings">R$ 96</div>
                <div class="stat-label">Ganhos Hoje</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="moto-rating">4.8</div>
                <div class="stat-label">Avaliação</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="moto-distance">38.4 km</div>
                <div class="stat-label">Distância</div>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>📍 Localização e Rota</h3>
                <div class="location-info">
                    <strong>Sua Localização Atual:</strong><br>
                    <span id="motoboy-location">Detectando localização GPS...</span>
                </div>
                <div class="order-info">
                    <strong>Pedido #1234</strong><br>
                    Origem: Doce Encanto<br>
                    Destino: Rua das Flores, 123<br>
                    Distância: <strong id="delivery-distance">Calculando...</strong>
                </div>
                <div class="map-container" id="map-motoboy">
                    <div class="map-marker" style="top: 20%; left: 30%; background: var(--success);"></div>
                    <div class="map-marker" style="top: 70%; left: 70%; background: var(--primary);"></div>
                </div>
                <button class="btn" style="margin-top: 1.5rem;" onclick="startNavigation()">Iniciar Navegação GPS</button>
            </div>
            <div class="dashboard-card">
                <h3>💳 Forma de Pagamento</h3>
                <div class="metric">💳 Cartão de Crédito</div>
                <p>Pagamento já processado online</p>
                <p style="color: var(--success); font-weight: bold; font-size: 1.3rem; margin-top: 1.5rem;">✓ Confirmado</p>
                <p style="margin-top: 1.5rem;">Não é necessário coletar pagamento</p>
            </div>
            <div class="dashboard-card">
                <h3>💰 Valor do Pedido</h3>
                <div class="metric">R$ 45,00</div>
                <p>Valor dos produtos: <strong>R$ 45,00</strong></p>
                <p>Taxa de entrega: <strong>R$ 8,00</strong></p>
                <div style="border-top: 3px solid var(--primary); margin: 1.5rem 0; padding-top: 1.5rem;">
                    <p style="font-size: 1.4rem;"><strong>Total: R$ 53,00</strong></p>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>🚚 Seu Ganho</h3>
                <div class="metric">R$ 8,00</div>
                <p>Taxa de entrega desta corrida</p>
                <p>Tempo estimado: <strong>15 minutos</strong></p>
                <p>Ganho por hora estimado: <strong>R$ 32,00</strong></p>
                <div class="chart-bar" style="width: 100%; background: linear-gradient(135deg, var(--success) 0%, #20c997 100%); margin-top: 1.5rem;"></div>
            </div>
            <div class="dashboard-card">
                <h3>✅ Confirmar Entrega</h3>
                <div class="order-info">
                    <strong>Cliente: Maria Silva</strong><br>
                    Telefone: (11) 98765-4321<br>
                    Endereço: Rua das Flores, 123<br>
                    Complemento: Apto 45, Bloco B<br>
                    Observações: <em>Deixar na portaria</em>
                </div>
                <button class="confirm-btn" onclick="confirmDelivery()">Confirmar Entrega</button>
            </div>
            <div class="dashboard-card">
                <h3>🎯 Próximas Entregas</h3>
                <div id="next-deliveries"></div>
                <button class="btn" style="margin-top: 1.5rem;">Aceitar Próximo Pedido</button>
            </div>
        </div>
    </section>

    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Meu Perfil</h3>
                <button class="close-modal" onclick="closeModal('profile-modal')">&times;</button>
            </div>
            <div id="profile-content"></div>
        </div>
    </div>

    <script>
        const APP_STATE = {
            currentUser: null,
            userType: null,
            cart: [],
            orderHistory: [],
            userPosition: null,
            watchId: null
        };

        function initApp() {
            loadUserSession();
            requestNotificationPermission();
            startLocationTracking();
        }

        function loadUserSession() {
            const session = localStorage.getItem('ia_sabor_session');
            if (session) {
                const data = JSON.parse(session);
                APP_STATE.currentUser = data.user;
                APP_STATE.userType = data.userType;
                
                if (data.cart) {
                    APP_STATE.cart = data.cart;
                }
                
                if (data.orderHistory) {
                    APP_STATE.orderHistory = data.orderHistory;
                }
            }
        }

        function saveUserSession() {
            const sessionData = {
                user: APP_STATE.currentUser,
                userType: APP_STATE.userType,
                cart: APP_STATE.cart,
                orderHistory: APP_STATE.orderHistory,
                timestamp: Date.now()
            };
            localStorage.setItem('ia_sabor_session', JSON.stringify(sessionData));
        }

        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(36);
        }

        function validatePassword(password) {
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*]/.test(password)
            };
            
            const strength = Object.values(requirements).filter(Boolean).length;
            return { requirements, strength };
        }

        function showLogin(userType) {
            document.getElementById('intro').style.display = 'none';
            document.getElementById(`login-${userType}`).style.display = 'flex';
        }

        function backToIntro() {
            document.querySelectorAll('.login-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById('intro').style.display = 'flex';
        }

        function showError(userType, message) {
            const errorEl = document.getElementById(`error-${userType}`);
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        function showSuccess(userType, message) {
            const successEl = document.getElementById(`success-${userType}`);
            successEl.textContent = message;
            successEl.style.display = 'block';
            setTimeout(() => {
                successEl.style.display = 'none';
            }, 3000);
        }

        function login(event, userType) {
            event.preventDefault();
            
            const email = document.getElementById(`email-${userType}`).value;
            const password = document.getElementById(`password-${userType}`).value;
            
            if (!email || !password) {
                showError(userType, 'Por favor, preencha todos os campos');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('ia_sabor_users') || '{}');
            const userKey = `${userType}_${email}`;
            
            if (users[userKey]) {
                const storedHash = users[userKey].password;
                const inputHash = hashPassword(password);
                
                if (storedHash === inputHash) {
                    APP_STATE.currentUser = users[userKey];
                    APP_STATE.userType = userType;
                    saveUserSession();
                    
                    document.getElementById(`login-${userType}`).style.display = 'none';
                    document.getElementById(`dashboard-${userType}`).style.display = 'block';
                    
                    const nameEl = document.getElementById(`user-name-${userType}`);
                    if (nameEl) {
                        nameEl.textContent = APP_STATE.currentUser.name || email.split('@')[0];
                    }
                    
                    initDashboard(userType);
                    showNotification('Login realizado com sucesso!', 'Bem-vindo ao IA Sabor');
                } else {
                    showError(userType, 'Senha incorreta');
                }
            } else {
                const newUser = {
                    email: email,
                    password: hashPassword(password),
                    name: email.split('@')[0],
                    createdAt: Date.now()
                };
                
                users[userKey] = newUser;
                localStorage.setItem('ia_sabor_users', JSON.stringify(users));
                
                APP_STATE.currentUser = newUser;
                APP_STATE.userType = userType;
                saveUserSession();
                
                document.getElementById(`login-${userType}`).style.display = 'none';
                document.getElementById(`dashboard-${userType}`).style.display = 'block';
                
                const nameEl = document.getElementById(`user-name-${userType}`);
                if (nameEl) {
                    nameEl.textContent = newUser.name;
                }
                
                initDashboard(userType);
                showNotification('Conta criada com sucesso!', 'Bem-vindo ao IA Sabor');
            }
        }

        function logout() {
            localStorage.removeItem('ia_sabor_session');
            APP_STATE.currentUser = null;
            APP_STATE.userType = null;
            APP_STATE.cart = [];
            
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById('intro').style.display = 'flex';
            
            if (APP_STATE.watchId) {
                navigator.geolocation.clearWatch(APP_STATE.watchId);
            }
            
            showNotification('Logout realizado', 'Até logo!');
        }

        function initDashboard(userType) {
            getUserLocation(userType);
            
            if (userType === 'cliente') {
                loadCart();
                loadOrderHistory();
                simulateDeliveryTime();
            } else if (userType === 'confeiteiro') {
                loadRecentOrders();
                updateStats();
            } else if (userType === 'motoboy') {
                loadNextDeliveries();
                calculateDeliveryDistance();
            }
        }

        function startLocationTracking() {
            if ('geolocation' in navigator) {
                APP_STATE.watchId = navigator.geolocation.watchPosition(
                    (position) => {
                        APP_STATE.userPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: position.timestamp
                        };
                        updateLocationDisplays();
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
        }

        function getUserLocation(userType) {
            if (navigator.geolocation) {
                const locationElements = {
                    'cliente': 'user-location',
                    'confeiteiro': 'store-location',
                    'motoboy': 'motoboy-location'
                };
                
                const elementId = locationElements[userType];
                const element = document.getElementById(elementId);
                
                if (element) {
                    element.innerHTML = '<div class="loading-spinner" style="width: 30px; height: 30px; margin: 0;"></div>';
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        APP_STATE.userPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        
                        if (element) {
                            element.innerHTML = `
                                Lat: ${APP_STATE.userPosition.lat.toFixed(6)}<br>
                                Lng: ${APP_STATE.userPosition.lng.toFixed(6)}<br>
                                <small>Precisão: ${APP_STATE.userPosition.accuracy.toFixed(0)}m</small>
                            `;
                        }
                        
                        if (userType === 'cliente') {
                            updateStoreDistances();
                        }
                        
                        showNotification('Localização detectada', 'GPS ativado com sucesso');
                    },
                    (error) => {
                        let errorMessage = 'Erro ao detectar localização';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Permissão de localização negada';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Localização indisponível';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Tempo esgotado ao buscar localização';
                                break;
                        }
                        
                        if (element) {
                            element.innerHTML = errorMessage;
                        }
                        showNotification('Aviso', errorMessage);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
        }

        function updateLocationDisplays() {
            if (!APP_STATE.userPosition) return;
            
            const elements = ['user-location', 'store-location', 'motoboy-location'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.parentElement.parentElement.style.display !== 'none') {
                    el.innerHTML = `
                        Lat: ${APP_STATE.userPosition.lat.toFixed(6)}<br>
                        Lng: ${APP_STATE.userPosition.lng.toFixed(6)}<br>
                        <small>Atualizado: ${new Date(APP_STATE.userPosition.timestamp).toLocaleTimeString()}</small>
                    `;
                }
            });
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateStoreDistances() {
            if (!APP_STATE.userPosition) return;
            
            const stores = [
                { name: 'Doce Encanto', lat: APP_STATE.userPosition.lat + 0.01, lng: APP_STATE.userPosition.lng + 0.01, open: true },
                { name: 'Sabor Divino', lat: APP_STATE.userPosition.lat + 0.02, lng: APP_STATE.userPosition.lng - 0.01, open: true },
                { name: 'Delícias da Vovó', lat: APP_STATE.userPosition.lat - 0.015, lng: APP_STATE.userPosition.lng + 0.02, open: false }
            ];
            
            stores.forEach(store => {
                store.distance = calculateDistance(
                    APP_STATE.userPosition.lat,
                    APP_STATE.userPosition.lng,
                    store.lat,
                    store.lng
                ).toFixed(1);
            });
            
            stores.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
            
            const storesList = document.getElementById('stores-list');
            if (storesList) {
                storesList.innerHTML = stores.map(store => `
                    <p>
                        <span class="status-badge ${store.open ? 'status-open' : 'status-closed'}">
                            ${store.open ? 'Aberta' : 'Fechada'}
                        </span> 
                        ${store.name} - ${store.distance}km
                    </p>
                `).join('');
            }
            
            const nearestDistance = document.getElementById('nearest-distance');
            if (nearestDistance) {
                nearestDistance.textContent = `${stores[0].distance} km`;
            }
        }

        function simulateDeliveryTime() {
            const timeElement = document.getElementById('delivery-time');
            const spinner = document.getElementById('time-spinner');
            
            if (timeElement && spinner) {
                timeElement.style.display = 'none';
                spinner.style.display = 'block';
                
                setTimeout(() => {
                    const minTime = Math.floor(Math.random() * 15 + 25);
                    const maxTime = minTime + 10;
                    timeElement.textContent = `${minTime}-${maxTime} min`;
                    timeElement.style.display = 'block';
                    spinner.style.display = 'none';
                }, 2000);
            }
        }

        function addToCart(productName, price) {
            const existingItem = APP_STATE.cart.find(item => item.name === productName);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                APP_STATE.cart.push({
                    name: productName,
                    price: price,
                    quantity: 1,
                    addedAt: Date.now()
                });
            }
            
            saveUserSession();
            loadCart();
            showNotification('Produto adicionado', `${productName} foi adicionado ao carrinho`);
        }

        function removeFromCart(index) {
            const item = APP_STATE.cart[index];
            APP_STATE.cart.splice(index, 1);
            saveUserSession();
            loadCart();
            showNotification('Produto removido', `${item.name} foi removido do carrinho`);
        }

        function loadCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            if (!cartItems || !cartTotal) return;
            
            if (APP_STATE.cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #999;">Carrinho vazio</p>';
                cartTotal.textContent = 'Total: R$ 0,00';
                return;
            }
            
            let total = 0;
            cartItems.innerHTML = APP_STATE.cart.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `
                    <div class="cart-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>Quantidade: ${item.quantity} x R$ ${item.price.toFixed(2)}</small>
                        </div>
                        <div class="cart-item-actions">
                            <strong>R$ ${itemTotal.toFixed(2)}</strong>
                            <button class="cart-item-btn remove" onclick="removeFromCart(${index})">Remover</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            cartTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        function clearCart() {
            if (APP_STATE.cart.length === 0) {
                showNotification('Carrinho vazio', 'Não há itens para remover');
                return;
            }
            
            if (confirm('Deseja realmente limpar o carrinho?')) {
                APP_STATE.cart = [];
                saveUserSession();
                loadCart();
                showNotification('Carrinho limpo', 'Todos os itens foram removidos');
            }
        }

        function checkout() {
            if (APP_STATE.cart.length === 0) {
                showNotification('Carrinho vazio', 'Adicione produtos antes de finalizar');
                return;
            }
            
            const order = {
                id: Date.now(),
                items: [...APP_STATE.cart],
                total: APP_STATE.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'Confirmado',
                date: new Date().toLocaleString('pt-BR'),
                location: APP_STATE.userPosition
            };
            
            APP_STATE.orderHistory.push(order);
            APP_STATE.cart = [];
            saveUserSession();
            
            loadCart();
            loadOrderHistory();
            
            showNotification('Pedido realizado!', `Pedido #${order.id} confirmado com sucesso`);
        }

        function loadOrderHistory() {
            const historyEl = document.getElementById('order-history');
            if (!historyEl) return;
            
            if (APP_STATE.orderHistory.length === 0) {
                historyEl.innerHTML = '<p style="text-align: center; color: #999;">Nenhum pedido anterior</p>';
                return;
            }
            
            historyEl.innerHTML = APP_STATE.orderHistory.slice(-5).reverse().map(order => `
                <div class="order-item">
                    <div>
                        <strong>Pedido #${order.id}</strong><br>
                        <small>${order.date}</small><br>
                        <small>${order.items.length} itens - ${order.status}</small>
                    </div>
                    <strong>R$ ${order.total.toFixed(2)}</strong>
                </div>
            `).join('');
        }

        function loadRecentOrders() {
            const ordersEl = document.getElementById('recent-orders');
            if (!ordersEl) return;
            
            const orders = [
                { id: 1234, client: 'Maria Silva', value: 45.00, status: 'Em preparo', time: '14:23' },
                { id: 1233, client: 'João Santos', value: 78.00, status: 'Pronto para entrega', time: '14:15' },
                { id: 1232, client: 'Ana Costa', value: 52.00, status: 'Aguardando confirmação', time: '14:08' }
            ];
            
            ordersEl.innerHTML = orders.map(order => `
                <div class="order-info">
                    <strong>Pedido #${order.id}</strong><br>
                    Cliente: ${order.client}<br>
                    Valor: R$ ${order.value.toFixed(2)}<br>
                    Status: <span style="color: var(--primary); font-weight: bold;">${order.status}</span><br>
                    Horário: ${order.time}
                </div>
            `).join('');
        }

        function loadNextDeliveries() {
            const deliveriesEl = document.getElementById('next-deliveries');
            if (!deliveriesEl) return;
            
            const deliveries = [
                { id: 1235, destination: 'Av. Paulista, 1000', distance: '2.8 km', earning: 7.50 },
                { id: 1236, destination: 'Rua Augusta, 500', distance: '4.1 km', earning: 9.00 }
            ];
            
            deliveriesEl.innerHTML = deliveries.map(delivery => `
                <div class="order-info">
                    <strong>Pedido #${delivery.id}</strong><br>
                    Destino: ${delivery.destination}<br>
                    Distância: ${delivery.distance}<br>
                    Ganho: R$ ${delivery.earning.toFixed(2)}
                </div>
            `).join('');
        }

        function calculateDeliveryDistance() {
            const distanceEl = document.getElementById('delivery-distance');
            if (!distanceEl || !APP_STATE.userPosition) return;
            
            const destinationLat = APP_STATE.userPosition.lat + 0.03;
            const destinationLng = APP_STATE.userPosition.lng + 0.02;
            
            const distance = calculateDistance(
                APP_STATE.userPosition.lat,
                APP_STATE.userPosition.lng,
                destinationLat,
                destinationLng
            );
            
            distanceEl.textContent = `${distance.toFixed(1)} km`;
        }

        function confirmDelivery() {
            const deliveriesEl = document.getElementById('moto-deliveries');
            const earningsEl = document.getElementById('moto-earnings');
            
            if (deliveriesEl) {
                const current = parseInt(deliveriesEl.textContent);
                deliveriesEl.textContent = current + 1;
            }
            
            if (earningsEl) {
                const current = parseFloat(earningsEl.textContent.replace('R$ ', ''));
                earningsEl.textContent = `R$ ${(current + 8).toFixed(0)}`;
            }
            
            showNotification('Entrega confirmada!', 'Parabéns pela entrega realizada');
        }

        function startNavigation() {
            if (!APP_STATE.userPosition) {
                showNotification('Localização necessária', 'Aguarde a detecção do GPS');
                return;
            }
            
            showNotification('Navegação iniciada', 'Siga as instruções do GPS');
        }

        function updateStats() {
            const stats = {
                orders: Math.floor(Math.random() * 10 + 15),
                revenue: Math.floor(Math.random() * 500 + 700),
                rating: (Math.random() * 0.5 + 4.5).toFixed(1),
                followers: Math.floor(Math.random() * 100 + 1200)
            };
            
            const elements = {
                'stat-orders': stats.orders,
                'stat-revenue': `R$ ${stats.revenue}`,
                'stat-rating': stats.rating,
                'stat-followers': stats.followers
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });
        }

        function sendNotificationToFollowers() {
            showNotification('Notificação enviada!', 'Todos os seus seguidores foram notificados');
        }

        function showStoreInfo(storeName) {
            showNotification('Confeitaria', `${storeName} - Clique para ver mais detalhes`);
        }

        function showProfile(userType) {
            const modal = document.getElementById('profile-modal');
            const content = document.getElementById('profile-content');
            
            if (!APP_STATE.currentUser) return;
            
            content.innerHTML = `
                <div class="profile-section">
                    <h4>Informações Pessoais</h4>
                    <div class="profile-field">
                        <label>Nome:</label>
                        <input type="text" value="${APP_STATE.currentUser.name || ''}" id="profile-name">
                    </div>
                    <div class="profile-field">
                        <label>Email:</label>
                        <input type="email" value="${APP_STATE.currentUser.email}" disabled>
                    </div>
                    <div class="profile-field">
                        <label>Telefone:</label>
                        <input type="tel" value="${APP_STATE.currentUser.phone || ''}" id="profile-phone">
                    </div>
                </div>
                <div class="profile-section">
                    <h4>Estatísticas</h4>
                    <p>Membro desde: ${new Date(APP_STATE.currentUser.createdAt).toLocaleDateString('pt-BR')}</p>
                    ${userType === 'cliente' ? `<p>Total de pedidos: ${APP_STATE.orderHistory.length}</p>` : ''}
                </div>
                <button class="btn" onclick="saveProfile()">Salvar Alterações</button>
            `;
            
            modal.style.display = 'flex';
        }

        function saveProfile() {
            const name = document.getElementById('profile-name').value;
            const phone = document.getElementById('profile-phone').value;
            
            APP_STATE.currentUser.name = name;
            APP_STATE.currentUser.phone = phone;
            
            const users = JSON.parse(localStorage.getItem('ia_sabor_users') || '{}');
            const userKey = `${APP_STATE.userType}_${APP_STATE.currentUser.email}`;
            users[userKey] = APP_STATE.currentUser;
            localStorage.setItem('ia_sabor_users', JSON.stringify(users));
            
            saveUserSession();
            
            const nameEl = document.getElementById(`user-name-${APP_STATE.userType}`);
            if (nameEl) {
                nameEl.textContent = name;
            }
            
            closeModal('profile-modal');
            showNotification('Perfil atualizado', 'Suas informações foram salvas');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showRegister(userType) {
            showNotification('Cadastro', 'Digite seu email e senha para criar uma conta');
        }

        function showNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 600);
            }, 4000);
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        setInterval(() => {
            if (APP_STATE.currentUser && APP_STATE.userType) {
                const dashboard = document.getElementById(`dashboard-${APP_STATE.userType}`);
                if (dashboard && dashboard.style.display === 'block') {
                    if (Math.random() > 0.8) {
                        const messages = {
                            'cliente': [
                                { title: 'Novo produto!', msg: 'Bolo de cenoura disponível' },
                                { title: 'Promoção!', msg: '20% de desconto em tortas' }
                            ],
                            'confeiteiro': [
                                { title: 'Novo pedido!', msg: 'Pedido #' + Math.floor(Math.random() * 9999) },
                                { title: 'Nova avaliação!', msg: 'Cliente deixou 5 estrelas' }
                            ],
                            'motoboy': [
                                { title: 'Nova entrega!', msg: 'Entrega disponível próxima a você' },
                                { title: 'Bônus!', msg: 'Meta de entregas atingida' }
                            ]
                        };
                        
                        const typeMessages = messages[APP_STATE.userType];
                        const randomMsg = typeMessages[Math.floor(Math.random() * typeMessages.length)];
                        showNotification(randomMsg.title, randomMsg.msg);
                    }
                }
            }
        }, 45000);

        window.addEventListener('load', initApp);
    </script>
</body>
</html>
